ubuntu@ubuntu-2204:~/Downloads/Projeto_final$ docker-compose -f docker-compose.staging.yml --env-file .env.staging exec product-service python -m pytest products_tests/ -v
====================================================================================== test session starts ======================================================================================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0 -- /usr/local/bin/python
cachedir: .pytest_cache
rootdir: /product-service
collected 6 items                                                                                                                                                                               

products_tests/test_product_service.py::TestProductService::test_health_check_detailed PASSED                                                                                             [ 16%]
products_tests/test_product_service.py::TestProductService::test_create_user_test PASSED                                                                                                  [ 33%]
products_tests/test_product_service.py::TestProductService::test_create_item PASSED                                                                                                       [ 50%]
products_tests/test_product_service.py::TestProductService::test_get_items PASSED                                                                                                         [ 66%]
products_tests/test_product_service.py::TestProductService::test_update_item PASSED                                                                                                       [ 83%]
products_tests/test_product_service.py::TestProductService::test_delete_item PASSED 

#AFTER CHANGES IN TEST FILE TO ADAPT TO DETECT THE PORT
(venv) ubuntu@ubuntu-2204:~/Downloads/Projeto_final$ docker-compose -f docker-compose.staging.yml --env-file .env.staging exec product-service python -m pytest products_tests/ -v -s
====================================================================================== test session starts ======================================================================================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0 -- /usr/local/bin/python
cachedir: .pytest_cache
rootdir: /product-service
collecting ... Environment Variables:
FLASK_RUN_PORT: 4002
STAGING_PRODUCT_PORT: None
PRODUCT_SERVICE_PORT: None
Inside Docker container? True
Using FLASK_RUN_PORT:4002
Checking if Product Service is up
Connection estabilished, status code: 200
response: {
  "status": "healthy"
}

collected 6 items                                                                                                                                                                               

products_tests/test_product_service.py::TestProductService::test_health_check_detailed [2025-12-12 17:42:03] - Detailed Health Check | Product Service - PASS
Details: Status: healthy, DB Connection: True, DB Query: True
response:{
  "checks": {
    "database_connection": true,
    "database_query": true,
    "service_responsive": true
  },
  "service": "product-service",
  "status": "healthy",
  "timestamp": "2025-12-12T17:42:03.735794"
}
----------------------------------------

PASSED
products_tests/test_product_service.py::TestProductService::test_create_user_test [2025-12-12 17:42:03] - Registration and login of test user for product test - PASS
Details: Email:True, User test ID:24
response:{
  "email": "product_test1765561323@example.com",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoyNCwiZW1haWwiOiJwcm9kdWN0X3Rlc3QxNzY1NTYxMzIzQGV4YW1wbGUuY29tIiwiZXhwIjoxNzY1NTY0OTIzfQ.KTh1ZFD2D5RwT49_fRfrvYHHHAakVgV09drIyi_yC8s",
  "user_id": 24,
  "headers": {
    "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoyNCwiZW1haWwiOiJwcm9kdWN0X3Rlc3QxNzY1NTYxMzIzQGV4YW1wbGUuY29tIiwiZXhwIjoxNzY1NTY0OTIzfQ.KTh1ZFD2D5RwT49_fRfrvYHHHAakVgV09drIyi_yC8s"
  }
}
----------------------------------------

PASSED
products_tests/test_product_service.py::TestProductService::test_create_item [2025-12-12 17:42:04] - Create product item - PASS
Details: Status:201, Product:test_2025-12-12 17:42:04, User:product_test1765561323@example.com
response:{
  "description": "Descritivo teste 2025-12-12 17:42:04",
  "id": 10,
  "message": "Product created successfully",
  "product_name": "test_2025-12-12 17:42:04"
}
----------------------------------------

PASSED
products_tests/test_product_service.py::TestProductService::test_get_items [2025-12-12 17:42:04] - Get user item list - PASS
Details: Status: 200, Products found: 2, Target product found: True
response:{
  "products": [
    {
      "created_at": "Fri, 12 Dec 2025 17:42:04 GMT",
      "created_by": 24,
      "description": "Descritivo teste 2025-12-12 17:42:04",
      "id": 10,
      "name": "test_2025-12-12 17:42:04",
      "price": 608.77,
      "quantity": 3
    },
    {
      "created_at": "Fri, 12 Dec 2025 17:42:04 GMT",
      "created_by": 24,
      "description": "Descritivo teste 2025-12-12 17:42:04",
      "id": 11,
      "name": "test_2025-12-12 17:42:04",
      "price": 1677.46,
      "quantity": 4
    }
  ]
}
----------------------------------------

PASSED
products_tests/test_product_service.py::TestProductService::test_update_item DEBUG:Creating product with data:{'name': 'test_2025-12-12 17:42:04', 'price': 467.1, 'description': 'Descritivo teste 2025-12-12 17:42:04', 'quantity': 2}
DEBUG: POST response status: 201
DEBUG: POST response body: {
  "description": "Descritivo teste 2025-12-12 17:42:04",
  "id": 12,
  "message": "Product created successfully",
  "product_name": "test_2025-12-12 17:42:04"
}

DEBUG: POST response JSON keys: dict_keys(['description', 'id', 'message', 'product_name'])
DEBUG: Extracted product_id: 12
DEBUG: Update payload: {'id': 12, 'name': 'updated_name_test', 'price': 199.99, 'description': 'Update_test description', 'quantity': 3}
DEBUG: PUT response status: 200
DEBUG: PUT response body: {
  "message": "Product updated successfully"
}

[2025-12-12 17:42:04] - Update user item list - PASS
Details: Product ID: 12, Update status: 200
response:{
  "message": "Product updated successfully"
}
----------------------------------------

PASSED
products_tests/test_product_service.py::TestProductService::test_delete_item [2025-12-12 17:42:04] - Delete product item - PASS
Details: Product ID: 13, Delete status: 200
response:{
  "deleted_product_id": 13,
  "message": "Product deleted successfully"
}
----------------------------------------

PASSED

======================================================================================= 6 passed in 0.51s =======================================================================================
(venv) ubuntu@ubuntu-2204:~/Downloads/Projeto_final$ 